---
/**
 * News listing page.
 *
 * Fetches the header info (title/subtitle/image) from the `news-listing`
 * page entry, then queries all news posts sorted newest-first and renders
 * them as a chronological list of cards.
 */
import BaseLayout from "@/layouts/BaseLayout.astro";
import PageHeader from "@/components/PageHeader.astro";
import { getEntry, getCollection } from "astro:content";

const listingPage = await getEntry("pages", "news-listing");
if (!listingPage) throw new Error("News listing page not found");
const posts = (await getCollection("news")).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime(),
);
---

<BaseLayout {...(listingPage.data.title && { title: listingPage.data.title })}>
  <PageHeader
    title={listingPage.data.title!}
    {...(listingPage.data.subtitle && { subtitle: listingPage.data.subtitle })}
    {...(listingPage.data.headerImage && { image: listingPage.data.headerImage })}
  />

  <div class="mx-auto max-w-container px-4 space-y-8">
    {posts.map((post) => (
      <article class="rounded-lg border border-border p-6 transition-shadow hover:shadow-md">
        <a href={`/news/${post.slug}/`} class="no-underline">
          <h2 class="text-xl font-bold font-heading text-primary">{post.data.title}</h2>
          <time
            datetime={post.data.date.toISOString()}
            class="mt-1 block text-sm text-muted-foreground"
          >
            {post.data.date.toLocaleDateString("en-CA", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })}
          </time>
          <p class="mt-3 text-foreground">{post.data.description}</p>
        </a>
      </article>
    ))}
  </div>
</BaseLayout>
