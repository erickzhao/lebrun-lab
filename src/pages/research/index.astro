---
/**
 * Research topics listing page.
 *
 * Shows all research topics as horizontal cards with a header image on the
 * left and title/subtitle/tags on the right. Tags are rendered as small
 * Badge components from shadcn/ui.
 */
import BaseLayout from "@/layouts/BaseLayout.astro";
import PageHeader from "@/components/PageHeader.astro";
import { getEntry, getCollection } from "astro:content";

const listingPage = await getEntry("pages", "research-listing");
if (!listingPage) throw new Error("Research listing page not found");
const topics = await getCollection("research");
---

<BaseLayout {...(listingPage.data.title && { title: listingPage.data.title })}>
  <PageHeader
    title={listingPage.data.title!}
    {...(listingPage.data.subtitle && { subtitle: listingPage.data.subtitle })}
    {...(listingPage.data.headerImage && { image: listingPage.data.headerImage })}
  />

  <div class="mx-auto max-w-container-wide px-4 space-y-8">
    {topics.map((topic) => (
      <a
        href={`/research/${topic.slug}/`}
        class="flex flex-col overflow-hidden rounded-lg border border-border shadow-sm transition-shadow hover:shadow-md no-underline md:flex-row"
      >
        {/* Header image */}
        {topic.data.headerImage && (
          <div class="h-48 md:h-auto md:w-72 md:shrink-0">
            <img
              src={topic.data.headerImage}
              alt={topic.data.title}
              class="h-full w-full object-cover"
            />
          </div>
        )}

        {/* Content */}
        <div class="flex flex-1 flex-col justify-center p-6">
          <h2 class="text-xl font-bold font-heading text-primary">{topic.data.title}</h2>
          <p class="mt-1 text-muted-foreground">{topic.data.subtitle}</p>
          {topic.data.tags.length > 0 && (
            <div class="mt-3 flex flex-wrap gap-2">
              {topic.data.tags.map((tag) => (
                <span class="inline-flex items-center rounded-full border border-border px-2.5 py-0.5 text-xs font-semibold text-muted-foreground">
                  {tag}
                </span>
              ))}
            </div>
          )}
        </div>
      </a>
    ))}
  </div>
</BaseLayout>
